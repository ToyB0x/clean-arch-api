# 予約表
CREATE TABLE IF NOT EXISTS reservation
(
    id           VARCHAR(255) CHARACTER SET ascii   NOT NULL, # uid
    schedule_id  VARCHAR(255) CHARACTER SET ascii   NOT NULL, # uid　
    ticket_id    VARCHAR(255) CHARACTER SET ascii   NOT NULL, # uid
    created_at   DATETIME                           NOT NULL,

    PRIMARY KEY (id),
    FOREIGN KEY fk_schedule_id(schedule_id) REFERENCES schedule(id)
);

/* NOTE: パーティショニングについて
 * パーティションニングの有無によりインサート性能改善はなかったため、以下はコメントアウト
 * (パーティションニング時はPRIMARY KEY (id, crated_at)にする必要があり無駄なため)
 * ---
 * 予約が600万レコード有る状態での、100回分のinsert速度は以下 (10回平均)
 * パーティショニング無し: 890950630 ナノ秒
 * パーティショニング有り: 867143171 ナノ秒
 */


# ALTER TABLE reservation
#     PARTITION BY RANGE COLUMNS(created_at)(
#         PARTITION p20210101 VALUES LESS THAN ('2021-01-01'),
#         PARTITION p20210201 VALUES LESS THAN ('2021-02-01'),
#         PARTITION p20210301 VALUES LESS THAN ('2021-03-01'),
#         PARTITION p20210401 VALUES LESS THAN ('2021-04-01'),
#         PARTITION p20210501 VALUES LESS THAN ('2021-05-01'),
#         PARTITION p20210601 VALUES LESS THAN ('2021-06-01'),
#         PARTITION p20210701 VALUES LESS THAN ('2021-07-01'),
#         PARTITION p20210801 VALUES LESS THAN ('2021-08-01'),
#         PARTITION p20210901 VALUES LESS THAN ('2021-09-01'),
#         PARTITION p20211001 VALUES LESS THAN ('2021-10-01'),
#         PARTITION p20211101 VALUES LESS THAN ('2021-11-01'),
#         PARTITION p20211201 VALUES LESS THAN ('2021-12-01'),
#         PARTITION p20220101 VALUES LESS THAN ('2022-01-01'),
#         PARTITION p20220201 VALUES LESS THAN ('2022-02-01'),
#         PARTITION p20220301 VALUES LESS THAN ('2022-03-01'),
#         PARTITION p20220401 VALUES LESS THAN ('2022-04-01'),
#         PARTITION p20220501 VALUES LESS THAN ('2022-05-01'),
#         PARTITION p20220601 VALUES LESS THAN ('2022-06-01'),
#         PARTITION p20220701 VALUES LESS THAN ('2022-07-01'),
#         PARTITION p20220801 VALUES LESS THAN ('2022-08-01'),
#         PARTITION p20220901 VALUES LESS THAN ('2022-09-01'),
#         PARTITION p20221001 VALUES LESS THAN ('2022-10-01'),
#         PARTITION p20221101 VALUES LESS THAN ('2022-11-01'),
#         PARTITION p20221201 VALUES LESS THAN ('2022-12-01'),
#         PARTITION p20230101 VALUES LESS THAN ('2023-01-01'),
#         PARTITION p20230201 VALUES LESS THAN ('2023-02-01'),
#         PARTITION p20230301 VALUES LESS THAN ('2023-03-01'),
#         PARTITION p20230401 VALUES LESS THAN ('2023-04-01'),
#         PARTITION p20230501 VALUES LESS THAN ('2023-05-01'),
#         PARTITION p20230601 VALUES LESS THAN ('2023-06-01'),
#         PARTITION p20230701 VALUES LESS THAN ('2023-07-01'),
#         PARTITION p20230801 VALUES LESS THAN ('2023-08-01'),
#         PARTITION p20230901 VALUES LESS THAN ('2023-09-01'),
#         PARTITION p20231001 VALUES LESS THAN ('2023-10-01'),
#         PARTITION p20230111 VALUES LESS THAN ('2023-11-01'),
#         PARTITION p20230121 VALUES LESS THAN ('2023-12-01'),
#         PARTITION p_over VALUES LESS THAN ('2024-01-01')
#         );
